<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Emergency Dispatch Simulator</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: #333;
            overflow-x: hidden;
        }
        
        .container {
            display: grid;
            grid-template-columns: 300px 1fr;
            grid-template-rows: 80px 1fr 120px;
            height: 100vh;
            grid-template-areas:
                "header header"
                "sidebar map"
                "resources map";
        }
        
        /* Mobile layout */
        .mobile-layout {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .mobile-header {
            background: linear-gradient(135deg, #012a4f 0%, #013a63 100%);
            color: white;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .mobile-tabs {
            display: flex;
            background: #013a63;
            border-bottom: 1px solid #012a4f;
        }
        
        .mobile-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            color: white;
            cursor: pointer;
            border-right: 1px solid #012a4f;
        }
        
        .mobile-tab.active {
            background: #035c96;
            font-weight: bold;
        }
        
        .mobile-content {
            flex: 1;
            overflow: auto;
            position: relative;
        }
        
        .tab-content {
            display: none;
            padding: 15px;
            height: 100%;
            overflow: auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .mobile-resources {
            background: #e9ecef;
            padding: 10px;
            border-top: 1px solid #ccc;
            display: flex;
            overflow-x: auto;
        }
        
        header {
            grid-area: header;
            background: linear-gradient(135deg, #012a4f 0%, #013a63 100%);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            margin-left: 10px;
        }
        
        .logo-icon {
            font-size: 2rem;
            margin-right: 10px;
        }
        
        .stats {
            display: flex;
            margin-left: auto;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            margin-left: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .stat-label {
            font-size: 0.8rem;
        }
        
        .sidebar {
            grid-area: sidebar;
            background-color: #fff;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .resources {
            grid-area: resources;
            background-color: #e9ecef;
            padding: 15px 20px;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .map-container {
            grid-area: map;
            position: relative;
        }
        
        #map {
            height: 100%;
            width: 100%;
        }
        
        h2 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #013a63;
            padding-bottom: 8px;
            border-bottom: 2px solid #013a63;
        }
        
        .building-item, .vehicle-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        
        .building-item:hover, .vehicle-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-name {
            font-weight: bold;
            color: #013a63;
        }
        
        .item-cost {
            color: #0d6efd;
            font-size: 0.9rem;
        }
        
        .item-action {
            background: #0d6efd;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .item-action:hover {
            background: #0b5ed7;
        }
        
        .resource-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .resource-item {
            background: #fff;
            border-radius: 8px;
            padding: 10px;
            min-width: 120px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .resource-count {
            font-size: 1.5rem;
            font-weight: bold;
            color: #013a63;
        }
        
        .resource-label {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .emergency-alert {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #dc3545;
            color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            max-width: 300px;
        }
        
        .alert-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .dispatch-btn {
            background: #198754;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            margin-top: 10px;
            cursor: pointer;
        }
        
        .control-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        .mobile-control-panel {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        .control-btn {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            cursor: pointer;
        }
        
        .control-btn.primary {
            background: #0d6efd;
        }
        
        /* Device detection styles */
        .desktop-ui {
            display: block;
        }
        
        .mobile-ui {
            display: none;
        }
        
        /* Mobile and Tablet Styles */
        @media (max-width: 992px) {
            .desktop-ui {
                display: none;
            }
            
            .mobile-ui {
                display: flex;
            }
            
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: 80px auto 1fr 120px;
                grid-template-areas:
                    "header"
                    "sidebar"
                    "map"
                    "resources";
            }
            
            .sidebar, .resources {
                box-shadow: none;
            }
            
            .stats {
                flex-wrap: wrap;
                justify-content: flex-end;
            }
            
            .stat-item {
                margin: 5px;
                padding: 5px 10px;
            }
            
            .resource-list {
                justify-content: center;
            }
            
            .resource-item {
                min-width: 100px;
                padding: 8px;
            }
            
            .control-panel {
                bottom: 10px;
                left: 10px;
                right: 10px;
                justify-content: center;
            }
            
            .emergency-alert {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
        
        @media (max-width: 576px) {
            header {
                padding: 0 10px;
            }
            
            .logo h1 {
                font-size: 1.2rem;
            }
            
            .stat-item {
                padding: 4px 8px;
            }
            
            .stat-value {
                font-size: 1rem;
            }
            
            .stat-label {
                font-size: 0.7rem;
            }
            
            .sidebar {
                padding: 15px 10px;
            }
            
            .building-item, .vehicle-item {
                padding: 10px;
                flex-direction: column;
                text-align: center;
            }
            
            .item-action {
                margin-top: 8px;
                width: 100%;
            }
            
            .resource-item {
                min-width: 80px;
                padding: 5px;
            }
            
            .resource-count {
                font-size: 1.2rem;
            }
            
            .control-panel {
                flex-direction: column;
            }
        }
        
        /* High contrast mode for accessibility */
        @media (prefers-contrast: high) {
            .building-item, .vehicle-item, .resource-item {
                border: 2px solid #000;
            }
            
            .item-action, .dispatch-btn, .control-btn {
                border: 2px solid #000;
            }
        }
        
        /* Reduced motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            .building-item, .vehicle-item {
                transition: none;
            }
            
            .building-item:hover, .vehicle-item:hover {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <!-- Desktop UI -->
    <div class="desktop-ui">
        <div class="container">
            <header>
                <div class="logo">
                    <div class="logo-icon">ðŸš¨</div>
                    <h1>Australian Emergency Dispatch Simulator</h1>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value">$<span id="money">50,000</span></div>
                        <div class="stat-label">Budget</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value"><span id="score">0</span></div>
                        <div class="stat-label">Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value"><span id="population">0</span></div>
                        <div class="stat-label">Population Served</div>
                    </div>
                </div>
            </header>
            
            <aside class="sidebar">
                <h2>Emergency Buildings</h2>
                <div id="buildings-list">
                    <div class="building-item">
                        <div class="item-info">
                            <div class="item-name">Fire Station</div>
                            <div class="item-cost">Cost: $15,000</div>
                        </div>
                        <button class="item-action" onclick="buyBuilding('fire-station')">Buy</button>
                    </div>
                    <div class="building-item">
                        <div class="item-info">
                            <div class="item-name">Police Station</div>
                            <div class="item-cost">Cost: $18,000</div>
                        </div>
                        <button class="item-action" onclick="buyBuilding('police-station')">Buy</button>
                    </div>
                    <div class="building-item">
                        <div class="item-info">
                            <div class="item-name">Ambulance Station</div>
                            <div class="item-cost">Cost: $12,000</div>
                        </div>
                        <button class="item-action" onclick="buyBuilding('ambulance-station')">Buy</button>
                    </div>
                    <div class="building-item">
                        <div class="item-info">
                            <div class="item-name">Emergency Coordination Center</div>
                            <div class="item-cost">Cost: $25,000</div>
                        </div>
                        <button class="item-action" onclick="buyBuilding('ecc')">Buy</button>
                    </div>
                </div>
                
                <h2 style="margin-top: 20px;">Emergency Vehicles</h2>
                <div id="vehicles-list">
                    <div class="vehicle-item">
                        <div class="item-info">
                            <div class="item-name">Fire Truck</div>
                            <div class="item-cost">Cost: $5,000</div>
                        </div>
                        <button class="item-action" onclick="buyVehicle('fire-truck')">Buy</button>
                    </div>
                    <div class="vehicle-item">
                        <div class="item-info">
                            <div class="item-name">Police Car</div>
                            <div class="item-cost">Cost: $4,000</div>
                        </div>
                        <button class="item-action" onclick="buyVehicle('police-car')">Buy</button>
                    </div>
                    <div class="vehicle-item">
                        <div class="item-info">
                            <div class="item-name">Ambulance</div>
                            <div class="item-cost">Cost: $4,500</div>
                        </div>
                        <button class="item-action" onclick="buyVehicle('ambulance')">Buy</button>
                    </div>
                </div>
            </aside>
            
            <div class="map-container">
                <div id="map"></div>
                
                <div class="emergency-alert" id="emergency-alert">
                    <div class="alert-title">ðŸš¨ Emergency Alert!</div>
                    <div id="alert-details">Bushfire reported near residential area</div>
                    <button class="dispatch-btn" onclick="dispatchUnits()">Dispatch Units</button>
                </div>
                
                <div class="control-panel">
                    <button class="control-btn" onclick="zoomToAustralia()">Zoom to Australia</button>
                    <button class="control-btn primary" onclick="generateEmergency()">Generate Emergency</button>
                </div>
            </div>
            
            <div class="resources">
                <h2>Your Resources</h2>
                <div class="resource-list">
                    <div class="resource-item">
                        <div class="resource-count" id="fire-station-count">0</div>
                        <div class="resource-label">Fire Stations</div>
                    </div>
                    <div class="resource-item">
                        <div class="resource-count" id="police-station-count">0</div>
                        <div class="resource-label">Police Stations</div>
                    </div>
                    <div class="resource-item">
                        <div class="resource-count" id="ambulance-station-count">0</div>
                        <div class="resource-label">Ambulance Stations</div>
                    </div>
                    <div class="resource-item">
                        <div class="resource-count" id="fire-truck-count">0</div>
                        <div class="resource-label">Fire Trucks</div>
                    </div>
                    <div class="resource-item">
                        <div class="resource-count" id="police-car-count">0</div>
                        <div class="resource-label">Police Cars</div>
                    </div>
                    <div class="resource-item">
                        <div class="resource-count" id="ambulance-count">0</div>
                        <div class="resource-label">Ambulances</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile UI -->
    <div class="mobile-ui">
        <div class="mobile-layout">
            <div class="mobile-header">
                <div class="logo">
                    <div class="logo-icon">ðŸš¨</div>
                    <h1>Emergency Dispatch</h1>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value">$<span id="mobile-money">50,000</span></div>
                        <div class="stat-label">Budget</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value"><span id="mobile-score">0</span></div>
                        <div class="stat-label">Score</div>
                    </div>
                </div>
            </div>
            
            <div class="mobile-tabs">
                <div class="mobile-tab active" data-tab="map">Map</div>
                <div class="mobile-tab" data-tab="buildings">Buildings</div>
                <div class="mobile-tab" data-tab="vehicles">Vehicles</div>
            </div>
            
            <div class="mobile-content">
                <div class="tab-content active" id="map-tab">
                    <div id="mobile-map" style="height: 100%; width: 100%;"></div>
                    
                    <div class="emergency-alert" id="mobile-emergency-alert">
                        <div class="alert-title">ðŸš¨ Emergency Alert!</div>
                        <div id="mobile-alert-details">Bushfire reported near residential area</div>
                        <button class="dispatch-btn" onclick="dispatchUnits()">Dispatch Units</button>
                    </div>
                    
                    <div class="mobile-control-panel">
                        <button class="control-btn" onclick="zoomToAustralia()">Zoom</button>
                        <button class="control-btn primary" onclick="generateEmergency()">Emergency</button>
                    </div>
                </div>
                
                <div class="tab-content" id="buildings-tab">
                    <h2>Emergency Buildings</h2>
                    <div class="building-item">
                        <div class="item-info">
                            <div class="item-name">Fire Station</div>
                            <div class="item-cost">Cost: $15,000</div>
                        </div>
                        <button class="item-action" onclick="buyBuilding('fire-station')">Buy</button>
                    </div>
                    <div class="building-item">
                        <div class="item-info">
                            <div class="item-name">Police Station</div>
                            <div class="item-cost">Cost: $18,000</div>
                        </div>
                        <button class="item-action" onclick="buyBuilding('police-station')">Buy</button>
                    </div>
                    <div class="building-item">
                        <div class="item-info">
                            <div class="item-name">Ambulance Station</div>
                            <div class="item-cost">Cost: $12,000</div>
                        </div>
                        <button class="item-action" onclick="buyBuilding('ambulance-station')">Buy</button>
                    </div>
                    <div class="building-item">
                        <div class="item-info">
                            <div class="item-name">Emergency Coordination Center</div>
                            <div class="item-cost">Cost: $25,000</div>
                        </div>
                        <button class="item-action" onclick="buyBuilding('ecc')">Buy</button>
                    </div>
                </div>
                
                <div class="tab-content" id="vehicles-tab">
                    <h2>Emergency Vehicles</h2>
                    <div class="vehicle-item">
                        <div class="item-info">
                            <div class="item-name">Fire Truck</div>
                            <div class="item-cost">Cost: $5,000</div>
                        </div>
                        <button class="item-action" onclick="buyVehicle('fire-truck')">Buy</button>
                    </div>
                    <div class="vehicle-item">
                        <div class="item-info">
                            <div class="item-name">Police Car</div>
                            <div class="item-cost">Cost: $4,000</div>
                        </div>
                        <button class="item-action" onclick="buyVehicle('police-car')">Buy</button>
                    </div>
                    <div class="vehicle-item">
                        <div class="item-info">
                            <div class="item-name">Ambulance</div>
                            <div class="item-cost">Cost: $4,500</div>
                        </div>
                        <button class="item-action" onclick="buyVehicle('ambulance')">Buy</button>
                    </div>
                </div>
            </div>
            
            <div class="mobile-resources">
                <div class="resource-item">
                    <div class="resource-count" id="mobile-fire-station-count">0</div>
                    <div class="resource-label">Fire Stations</div>
                </div>
                <div class="resource-item">
                    <div class="resource-count" id="mobile-police-station-count">0</div>
                    <div class="resource-label">Police Stations</div>
                </div>
                <div class="resource-item">
                    <div class="resource-count" id="mobile-ambulance-station-count">0</div>
                    <div class="resource-label">Ambulance Stations</div>
                </div>
                <div class="resource-item">
                    <div class="resource-count" id="mobile-fire-truck-count">0</div>
                    <div class="resource-label">Fire Trucks</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Initialize maps
        let map, mobileMap;
        let isMobile = false;
        
        // Initialize the application
        function initApp() {
            // Detect device type
            detectDeviceType();
            
            // Initialize the appropriate map
            if (isMobile) {
                initMobileMap();
            } else {
                initDesktopMap();
            }
            
            // Add tab functionality for mobile
            initTabs();
            
            // Initialize the UI
            updateUI();
        }
        
        // Detect device type
        function detectDeviceType() {
            const userAgent = navigator.userAgent;
            const mobileDevices = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;
            isMobile = mobileDevices.test(userAgent) || window.innerWidth <= 992;
            
            console.log("Device detected as: ", isMobile ? "Mobile" : "Desktop");
        }
        
        // Initialize desktop map
        function initDesktopMap() {
            map = L.map('map').setView([-25.2744, 133.7751], 5);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Add some initial markers for major cities
            addCityMarkers(map);
        }
        
        // Initialize mobile map
        function initMobileMap() {
            mobileMap = L.map('mobile-map').setView([-25.2744, 133.7751], 5);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(mobileMap);
            
            // Add some initial markers for major cities
            addCityMarkers(mobileMap);
        }
        
        // Add city markers to map
        function addCityMarkers(mapInstance) {
            const cities = [
                { name: 'Sydney', lat: -33.8688, lng: 151.2093 },
                { name: 'Melbourne', lat: -37.8136, lng: 144.9631 },
                { name: 'Brisbane', lat: -27.4698, lng: 153.0251 },
                { name: 'Perth', lat: -31.9505, lng: 115.8605 },
                { name: 'Adelaide', lat: -34.9285, lng: 138.6007 },
                { name: 'Darwin', lat: -12.4634, lng: 130.8456 },
                { name: 'Hobart', lat: -42.8821, lng: 147.3272 },
                { name: 'Canberra', lat: -35.2809, lng: 149.1300 }
            ];
            
            cities.forEach(city => {
                L.marker([city.lat, city.lng]).addTo(mapInstance)
                    .bindPopup(city.name);
            });
        }
        
        // Initialize mobile tabs
        function initTabs() {
            if (!isMobile) return;
            
            const tabs = document.querySelectorAll('.mobile-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Hide all tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Show the selected tab content
                    const tabName = tab.getAttribute('data-tab');
                    document.getElementById(`${tabName}-tab`).classList.add('active');
                });
            });
        }
        
        // Game state
        const gameState = {
            money: 50000,
            score: 0,
            population: 0,
            buildings: {
                'fire-station': { count: 0, cost: 15000 },
                'police-station': { count: 0, cost: 18000 },
                'ambulance-station': { count: 0, cost: 12000 },
                'ecc': { count: 0, cost: 25000 }
            },
            vehicles: {
                'fire-truck': { count: 0, cost: 5000 },
                'police-car': { count: 0, cost: 4000 },
                'ambulance': { count: 0, cost: 4500 }
            },
            markers: [],
            activeEmergency: null
        };
        
        // Update UI with current game state
        function updateUI() {
            // Update desktop UI
            const moneyElement = document.getElementById('money');
            const scoreElement = document.getElementById('score');
            const populationElement = document.getElementById('population');
            
            if (moneyElement) moneyElement.textContent = gameState.money.toLocaleString();
            if (scoreElement) scoreElement.textContent = gameState.score.toLocaleString();
            if (populationElement) populationElement.textContent = gameState.population.toLocaleString();
            
            // Update mobile UI
            const mobileMoneyElement = document.getElementById('mobile-money');
            const mobileScoreElement = document.getElementById('mobile-score');
            
            if (mobileMoneyElement) mobileMoneyElement.textContent = gameState.money.toLocaleString();
            if (mobileScoreElement) mobileScoreElement.textContent = gameState.score.toLocaleString();
            
            // Update building counts
            for (const building in gameState.buildings) {
                const element = document.getElementById(`${building}-count`);
                const mobileElement = document.getElementById(`mobile-${building}-count`);
                
                if (element) element.textContent = gameState.buildings[building].count;
                if (mobileElement) mobileElement.textContent = gameState.buildings[building].count;
            }
            
            // Update vehicle counts
            for (const vehicle in gameState.vehicles) {
                const element = document.getElementById(`${vehicle}-count`);
                const mobileElement = document.getElementById(`mobile-${vehicle}-count`);
                
                if (element) element.textContent = gameState.vehicles[vehicle].count;
                if (mobileElement && mobileElement.parentElement.style.display !== 'none') {
                    mobileElement.textContent = gameState.vehicles[vehicle].count;
                }
            }
        }
        
        // Buy a building
        function buyBuilding(type) {
            const building = gameState.buildings[type];
            if (gameState.money >= building.cost) {
                gameState.money -= building.cost;
                building.count++;
                
                // Add a marker for the building
                const lat = -25.2744 + (Math.random() * 10 - 5);
                const lng = 133.7751 + (Math.random() * 10 - 5);
                
                let icon;
                if (type === 'fire-station') {
                    icon = L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41]
                    });
                } else if (type === 'police-station') {
                    icon = L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41]
                    });
                } else {
                    icon = L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41]
                    });
                }
                
                const currentMap = isMobile ? mobileMap : map;
                const marker = L.marker([lat, lng], { icon: icon }).addTo(currentMap)
                    .bindPopup(type.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '));
                
                gameState.markers.push(marker);
                gameState.population += Math.floor(Math.random() * 5000) + 5000;
                gameState.score += 100;
                
                updateUI();
            } else {
                alert('Not enough money!');
            }
        }
        
        // Buy a vehicle
        function buyVehicle(type) {
            const vehicle = gameState.vehicles[type];
            if (gameState.money >= vehicle.cost) {
                gameState.money -= vehicle.cost;
                vehicle.count++;
                gameState.score += 50;
                
                updateUI();
            } else {
                alert('Not enough money!');
            }
        }
        
        // Generate an emergency
        function generateEmergency() {
            if (gameState.activeEmergency) return;
            
            const emergencies = [
                { type: 'fire', name: 'Bushfire', description: 'Bushfire reported near residential area' },
                { type: 'crime', name: 'Robbery', description: 'Robbery in progress at city bank' },
                { type: 'medical', name: 'Mass Casualty', description: 'Multi-vehicle accident on highway' }
            ];
            
            const emergency = emergencies[Math.floor(Math.random() * emergencies.length)];
            
            // Random location in Australia
            const lat = -25.2744 + (Math.random() * 15 - 7.5);
            const lng = 133.7751 + (Math.random() * 15 - 7.5);
            
            const alert = isMobile ? document.getElementById('mobile-emergency-alert') : document.getElementById('emergency-alert');
            const alertDetails = isMobile ? document.getElementById('mobile-alert-details') : document.getElementById('alert-details');
            
            if (alert && alertDetails) {
                alertDetails.textContent = emergency.description;
                alert.style.display = 'block';
            }
            
            // Add emergency marker
            const emergencyIcon = L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41]
            });
            
            const currentMap = isMobile ? mobileMap : map;
            const marker = L.marker([lat, lng], { icon: emergencyIcon }).addTo(currentMap)
                .bindPopup(`ðŸš¨ ${emergency.name}`)
                .openPopup();
            
            gameState.activeEmergency = {
                type: emergency.type,
                marker: marker,
                resolved: false
            };
            
            // Auto-hide alert after 30 seconds if not resolved
            setTimeout(() => {
                if (gameState.activeEmergency && !gameState.activeEmergency.resolved) {
                    if (alert) alert.style.display = 'none';
                    gameState.score -= 200;
                    currentMap.removeLayer(marker);
                    gameState.activeEmergency = null;
                    updateUI();
                    alert('Emergency response failed! Score decreased.');
                }
            }, 30000);
        }
        
        // Dispatch units to emergency
        function dispatchUnits() {
            if (!gameState.activeEmergency) return;
            
            const emergency = gameState.activeEmergency;
            let requiredVehicle = '';
            let requiredCount = 0;
            
            if (emergency.type === 'fire') {
                requiredVehicle = 'fire-truck';
                requiredCount = 2;
            } else if (emergency.type === 'crime') {
                requiredVehicle = 'police-car';
                requiredCount = 3;
            } else if (emergency.type === 'medical') {
                requiredVehicle = 'ambulance';
                requiredCount = 2;
            }
            
            if (gameState.vehicles[requiredVehicle].count >= requiredCount) {
                // Success
                const alert = isMobile ? document.getElementById('mobile-emergency-alert') : document.getElementById('emergency-alert');
                if (alert) alert.style.display = 'none';
                
                emergency.marker.setIcon(L.icon({
                    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41]
                }));
                
                emergency.resolved = true;
                gameState.score += 300;
                gameState.money += 10000;
                gameState.population += 1000;
                
                updateUI();
                
                setTimeout(() => {
                    const currentMap = isMobile ? mobileMap : map;
                    currentMap.removeLayer(emergency.marker);
                    gameState.activeEmergency = null;
                }, 5000);
            } else {
                alert(`Not enough resources! You need ${requiredCount} ${requiredVehicle.replace('-', ' ')}s.`);
            }
        }
        
        // Zoom to show all of Australia
        function zoomToAustralia() {
            const currentMap = isMobile ? mobileMap : map;
            currentMap.setView([-25.2744, 133.7751], 5);
        }
        
        // Initialize the app when the page loads
        window.onload = initApp;
    </script>
</body>
</html>